<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Rhomboid's blog - tweaks</title><link href="https://rhomboid.org/" rel="alternate"></link><link href="https://rhomboid.org/feeds/tweaks.atom.xml" rel="self"></link><id>https://rhomboid.org/</id><updated>2023-04-24T20:50:50-07:00</updated><subtitle>Misc tips and brain dumps.</subtitle><entry><title>Improving Firefox’s scaletempo parameters for better audio playback at greater than 1x speed</title><link href="https://rhomboid.org/firefox-scaletempo-improve.html" rel="alternate"></link><published>2023-04-24T20:50:50-07:00</published><updated>2023-04-24T20:50:50-07:00</updated><author><name>Rhomboid</name></author><id>tag:rhomboid.org,2023-04-24:/firefox-scaletempo-improve.html</id><summary type="html">&lt;p&gt;When you play media files in the browser at speeds other than 1x, the browser uses an algorithm that scales the speed without affecting pitch. (Without this, it would have &lt;a href="https://www.youtube.com/watch?v=np2ZapISRzM"&gt;the Chipmunk effect&lt;/a&gt;.) The most common implementation is &lt;a href="https://scaletempo.sourceforge.net/0/"&gt;Scaletempo&lt;/a&gt;, which is used all over the place because it&amp;#8217;s open …&lt;/p&gt;</summary><content type="html">&lt;p&gt;When you play media files in the browser at speeds other than 1x, the browser uses an algorithm that scales the speed without affecting pitch. (Without this, it would have &lt;a href="https://www.youtube.com/watch?v=np2ZapISRzM"&gt;the Chipmunk effect&lt;/a&gt;.) The most common implementation is &lt;a href="https://scaletempo.sourceforge.net/0/"&gt;Scaletempo&lt;/a&gt;, which is used all over the place because it&amp;#8217;s open source, relatively efficient, and sounds decent. It works by cutting the audio into short segments (strides), and then blending them together with small overlaps. It searchs for similarities when choosing the overlapping areas, to minimize distortion or&amp;nbsp;pops.&lt;/p&gt;
&lt;p&gt;For whatever brain-dead reason, Firefox&amp;#8217;s default implementation of Scaletempo has a poor choice of parameters. If you often watch Youtube videos at 1.5x or whatever, you might consider tweaking these. There are three main parameters of interest: &lt;strong&gt;stride&lt;/strong&gt;, &lt;strong&gt;overlap&lt;/strong&gt;, and &lt;strong&gt;search&lt;/strong&gt;. The &lt;strong&gt;stride&lt;/strong&gt; parameter determines the lengh in milliseconds of the segments, &lt;strong&gt;overlap&lt;/strong&gt; determines how much any two segments are allowed to overlap, and &lt;strong&gt;search&lt;/strong&gt; defines how far to look for candidate segment&amp;nbsp;boundaries.&lt;/p&gt;
&lt;p&gt;Firefox&amp;#8217;s defaults for these three are 10, 8, 15 respectively. Here&amp;#8217;s the &lt;a href="https://hg.mozilla.org/mozilla-central/file/tip/modules/libpref/init/StaticPrefList.yaml#l10957"&gt;documentation from the source tree&lt;/a&gt; (from Firefox&amp;nbsp;112):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# Time-stretch algorithm single processing sequence length in milliseconds.&lt;/span&gt;
&lt;span class="c1"&gt;# This determines to how long sequences the original sound is chopped in the&lt;/span&gt;
&lt;span class="c1"&gt;# time-stretch algorithm.&lt;/span&gt;
&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;media.audio.playbackrate.soundtouch_sequence_ms&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;RelaxedAtomicInt32&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;value&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;10&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;mirror&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;always&lt;/span&gt;

&lt;span class="c1"&gt;# Time-stretch algorithm overlap length in milliseconds. When the chopped sound&lt;/span&gt;
&lt;span class="c1"&gt;# sequences are mixed back together, to form a continuous sound stream, this&lt;/span&gt;
&lt;span class="c1"&gt;# parameter defines over how long period the two consecutive sequences are let&lt;/span&gt;
&lt;span class="c1"&gt;# to overlap each other.&lt;/span&gt;
&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;media.audio.playbackrate.soundtouch_overlap_ms&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;RelaxedAtomicInt32&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;value&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;8&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;mirror&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;always&lt;/span&gt;

&lt;span class="c1"&gt;# Time-stretch algorithm seeking window length in milliseconds for algorithm&lt;/span&gt;
&lt;span class="c1"&gt;# that finds the best possible overlapping location. This determines from how&lt;/span&gt;
&lt;span class="c1"&gt;# wide window the algorithm may look for an optimal joining location when mixing&lt;/span&gt;
&lt;span class="c1"&gt;# the sound sequences back together.&lt;/span&gt;
&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;media.audio.playbackrate.soundtouch_seekwindow_ms&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;RelaxedAtomicInt32&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;value&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;15&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;mirror&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;always&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;From my own experimentation, I have settled on the values 35 / 10 / 20, corresponding to the following lines in &lt;code&gt;prefs.js&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;user_pref(&amp;quot;media.audio.playbackrate.soundtouch_sequence_ms&amp;quot;, 35);
user_pref(&amp;quot;media.audio.playbackrate.soundtouch_overlap_ms&amp;quot;, 10);
user_pref(&amp;quot;media.audio.playbackrate.soundtouch_seekwindow_ms&amp;quot;, 20);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;You can also enter these in &lt;code&gt;about:config&lt;/code&gt;. Feel free to experiment and see what sounds best for&amp;nbsp;you.&lt;/p&gt;</content><category term="tweaks"></category><category term="audio"></category><category term="firefox"></category><category term="scaletempo"></category></entry></feed>